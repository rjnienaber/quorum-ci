package Libraries.Language.Compile

use Libraries.Language.Compile.Context.all
use Libraries.Containers.Stack
use Libraries.Language.Compile.Symbol.all


class Parser is QuorumSourceListener
    Stack<Expression> stack
    Stack<integer> intStack
    QualifiedName packageValue = undefined
    Source source
    SymbolTable symbolTable = undefined

    action EnterStart(StartContext context) 
        source:SetFile(me:GetFile())
        symbolTable = me:GetSymbolTable()
    end

    action ExitPackageRule(PackageContext context) 
        packageValue = context:name
    end

    action EnterFullClassDeclaration(FullClassDeclarationContext context)
        text name = context:className
        text key = packageValue:GetStaticKey() + "." + name
        Class clazz
        clazz:SetName(name)
        CompilerError error = symbolTable:Add(clazz)
        if error not= undefined
            CompilerErrorManager manager = GetCompilerErrorManager()
            manager:AddError(error)
        end
    end

    action ExitFullClassDeclaration(FullClassDeclarationContext context) 
        
    end

    action EnterNoClassDeclaration(NoClassDeclarationContext context) end
    action ExitNoClassDeclaration(NoClassDeclarationContext context)  end

    action ExitInteger(IntegerContext int)
        Expression e
        stack:Push(e)
        intStack:Push(int:value)
        output "pushed " + int:value
    end

    action EnterAssignmentStatement output "Enter Assignment" end
    action ExitAssignmentStatement output "Exit Assignment" end

    action ExitMultiplication 
        integer right = intStack:Pop()
        integer left = intStack:Pop()
        intStack:Push(left * right)

        output "* = " + (right * left)
    end

    action ExitAddition(Addition addition) 
        integer right = intStack:Pop()
        integer left = intStack:Pop()
        intStack:Push(left + right)

        output "+ = " + (right + left)  
    end
end